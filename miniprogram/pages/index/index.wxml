<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜ -->
  <view class="header">
    <view class="header-left">
      <view class="logo">
        <text class="logo-icon">âš”</text>
      </view>
      <view class="title-group">
        <text class="title">OW2 <text class="title-highlight">å…‹åˆ¶åŠ©æ‰‹</text></text>
        <text class="subtitle">S19 / SEASON 2025</text>
      </view>
    </view>
    <view class="header-right" wx:if="{{selectedEnemies.length > 0}}">
      <button class="reset-btn" bindtap="onClearSelection">
        <text class="reset-icon">â†º</text>
        <text>é‡ç½®</text>
      </button>
    </view>
  </view>

  <!-- æ•Œæ–¹é˜µå®¹é€‰æ‹©åŒº -->
  <view class="selection-section">
    <view class="section-header">
      <view class="section-title">
        <text class="section-icon">ğŸ¯</text>
        <text>é€‰æ‹©æ•Œæ–¹é˜µå®¹ (æœ€å¤š6äºº)</text>
      </view>
      <text class="counter {{selectedEnemies.length >= 6 ? 'counter-full' : ''}}">{{selectedEnemies.length}} / 6</text>
    </view>

    <view class="selection-area {{selectedEnemies.length > 0 ? 'selection-active' : ''}}">
      <view wx:if="{{selectedEnemies.length === 0}}" class="selection-empty">
        <text class="empty-icon">ğŸ‘¥</text>
        <text class="empty-text">ç‚¹å‡»ä¸‹æ–¹è‹±é›„å›¾æ ‡æ„å»ºæ•Œæ–¹é˜µå®¹</text>
      </view>
      <view wx:else class="selected-heroes">
        <view
          wx:for="{{selectedEnemies}}"
          wx:key="id"
          class="selected-hero"
          bindtap="onRemoveEnemy"
          data-id="{{item.id}}"
        >
          <image
            class="hero-avatar-large"
            src="{{'/images/' + (item.id === 'wrecking-ball' ? 'ball' : item.id === 'soldier-76' ? 'soldier76' : item.id === 'junker-queen' ? 'junkerqueen' : item.id === 'venture' ? 'æ¢å¥‡' : item.id === 'hazard' ? 'éª‡ç¾' : item.id === 'freja' ? 'èŠ™è•¾é›…' : item.id === 'wuyang' ? 'æ— æ¼¾' : item.id) + '.png'}}"
            mode="aspectFill"
          />
          <view class="remove-badge">âœ•</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆ˜æœ¯åˆ†æç»“æœ -->
  <view wx:if="{{calculatedCounters}}" class="analysis-section">
    <view class="analysis-header">
      <view class="analysis-bar"></view>
      <text class="analysis-title">æˆ˜æœ¯ <text class="analysis-highlight">åˆ†æ</text></text>
    </view>

    <!-- é‡è£…æ¨è -->
    <view class="role-card">
      <view class="role-header tank-header">
        <view class="role-icon-wrap">
          <text class="role-icon">ğŸ›¡</text>
        </view>
        <text class="role-name">é‡è£…</text>
      </view>
      <view class="role-content">
        <block wx:if="{{calculatedCounters.tank.length > 0}}">
          <view
            wx:for="{{calculatedCounters.tank}}"
            wx:key="name"
            class="hero-recommendation {{item.score === calculatedCounters.maxScores.tank && calculatedCounters.maxScores.tank > 1 ? 'mvp' : ''}}"
            bindtap="onViewDetail"
            data-hero="{{item.fullEntry}}"
            data-matches="{{item.matches}}"
            data-risks="{{item.risks}}"
          >
            <view class="rec-left">
              <image
                class="rec-avatar"
                src="{{'/images/' + (item.fullEntry.id === 'wrecking-ball' ? 'ball' : item.fullEntry.id === 'soldier-76' ? 'soldier76' : item.fullEntry.id === 'junker-queen' ? 'junkerqueen' : item.fullEntry.id === 'venture' ? 'æ¢å¥‡' : item.fullEntry.id === 'hazard' ? 'éª‡ç¾' : item.fullEntry.id === 'freja' ? 'èŠ™è•¾é›…' : item.fullEntry.id === 'wuyang' ? 'æ— æ¼¾' : item.fullEntry.id) + '.png'}}"
                mode="aspectFill"
              />
              <view wx:if="{{item.score === calculatedCounters.maxScores.tank && calculatedCounters.maxScores.tank > 1}}" class="mvp-badge">
                <text>â­ MVP</text>
              </view>
            </view>
            <view class="rec-right">
              <view class="rec-header">
                <text class="rec-name">{{item.name}}</text>
                <text class="rec-score">å…‹åˆ¶æŒ‡æ•°: {{item.score}}</text>
              </view>
              <view wx:if="{{item.risks.length > 0}}" class="risk-warning">
                <text class="risk-icon">âš </text>
                <text class="risk-text">è¢« </text>
                <text wx:for="{{item.risks}}" wx:for-item="risk" wx:key="id" class="risk-name">{{risk.name}} </text>
                <text class="risk-text">å…‹åˆ¶</text>
              </view>
              <view class="rec-preview">
                <text class="preview-label">é’ˆå¯¹: </text>
                <text wx:for="{{item.matches}}" wx:for-item="match" wx:key="target.id" class="preview-target">{{match.target.name}} </text>
              </view>
            </view>
            <view class="rec-arrow">â€º</view>
          </view>
        </block>
        <view wx:else class="empty-role">
          <text>æš‚æ— æ¨è</text>
        </view>
      </view>
    </view>

    <!-- è¾“å‡ºæ¨è -->
    <view class="role-card">
      <view class="role-header damage-header">
        <view class="role-icon-wrap">
          <text class="role-icon">ğŸ¯</text>
        </view>
        <text class="role-name">è¾“å‡º</text>
      </view>
      <view class="role-content">
        <block wx:if="{{calculatedCounters.damage.length > 0}}">
          <view
            wx:for="{{calculatedCounters.damage}}"
            wx:key="name"
            class="hero-recommendation {{item.score === calculatedCounters.maxScores.damage && calculatedCounters.maxScores.damage > 1 ? 'mvp' : ''}}"
            bindtap="onViewDetail"
            data-hero="{{item.fullEntry}}"
            data-matches="{{item.matches}}"
            data-risks="{{item.risks}}"
          >
            <view class="rec-left">
              <image
                class="rec-avatar"
                src="{{'/images/' + (item.fullEntry.id === 'wrecking-ball' ? 'ball' : item.fullEntry.id === 'soldier-76' ? 'soldier76' : item.fullEntry.id === 'junker-queen' ? 'junkerqueen' : item.fullEntry.id === 'venture' ? 'æ¢å¥‡' : item.fullEntry.id === 'hazard' ? 'éª‡ç¾' : item.fullEntry.id === 'freja' ? 'èŠ™è•¾é›…' : item.fullEntry.id === 'wuyang' ? 'æ— æ¼¾' : item.fullEntry.id) + '.png'}}"
                mode="aspectFill"
              />
              <view wx:if="{{item.score === calculatedCounters.maxScores.damage && calculatedCounters.maxScores.damage > 1}}" class="mvp-badge">
                <text>â­ MVP</text>
              </view>
            </view>
            <view class="rec-right">
              <view class="rec-header">
                <text class="rec-name">{{item.name}}</text>
                <text class="rec-score">å…‹åˆ¶æŒ‡æ•°: {{item.score}}</text>
              </view>
              <view wx:if="{{item.risks.length > 0}}" class="risk-warning">
                <text class="risk-icon">âš </text>
                <text class="risk-text">è¢« </text>
                <text wx:for="{{item.risks}}" wx:for-item="risk" wx:key="id" class="risk-name">{{risk.name}} </text>
                <text class="risk-text">å…‹åˆ¶</text>
              </view>
              <view class="rec-preview">
                <text class="preview-label">é’ˆå¯¹: </text>
                <text wx:for="{{item.matches}}" wx:for-item="match" wx:key="target.id" class="preview-target">{{match.target.name}} </text>
              </view>
            </view>
            <view class="rec-arrow">â€º</view>
          </view>
        </block>
        <view wx:else class="empty-role">
          <text>æš‚æ— æ¨è</text>
        </view>
      </view>
    </view>

    <!-- æ”¯æ´æ¨è -->
    <view class="role-card">
      <view class="role-header support-header">
        <view class="role-icon-wrap">
          <text class="role-icon">ğŸ’š</text>
        </view>
        <text class="role-name">æ”¯æ´</text>
      </view>
      <view class="role-content">
        <block wx:if="{{calculatedCounters.support.length > 0}}">
          <view
            wx:for="{{calculatedCounters.support}}"
            wx:key="name"
            class="hero-recommendation {{item.score === calculatedCounters.maxScores.support && calculatedCounters.maxScores.support > 1 ? 'mvp' : ''}}"
            bindtap="onViewDetail"
            data-hero="{{item.fullEntry}}"
            data-matches="{{item.matches}}"
            data-risks="{{item.risks}}"
          >
            <view class="rec-left">
              <image
                class="rec-avatar"
                src="{{'/images/' + (item.fullEntry.id === 'wrecking-ball' ? 'ball' : item.fullEntry.id === 'soldier-76' ? 'soldier76' : item.fullEntry.id === 'junker-queen' ? 'junkerqueen' : item.fullEntry.id === 'venture' ? 'æ¢å¥‡' : item.fullEntry.id === 'hazard' ? 'éª‡ç¾' : item.fullEntry.id === 'freja' ? 'èŠ™è•¾é›…' : item.fullEntry.id === 'wuyang' ? 'æ— æ¼¾' : item.fullEntry.id) + '.png'}}"
                mode="aspectFill"
              />
              <view wx:if="{{item.score === calculatedCounters.maxScores.support && calculatedCounters.maxScores.support > 1}}" class="mvp-badge">
                <text>â­ MVP</text>
              </view>
            </view>
            <view class="rec-right">
              <view class="rec-header">
                <text class="rec-name">{{item.name}}</text>
                <text class="rec-score">å…‹åˆ¶æŒ‡æ•°: {{item.score}}</text>
              </view>
              <view wx:if="{{item.risks.length > 0}}" class="risk-warning">
                <text class="risk-icon">âš </text>
                <text class="risk-text">è¢« </text>
                <text wx:for="{{item.risks}}" wx:for-item="risk" wx:key="id" class="risk-name">{{risk.name}} </text>
                <text class="risk-text">å…‹åˆ¶</text>
              </view>
              <view class="rec-preview">
                <text class="preview-label">é’ˆå¯¹: </text>
                <text wx:for="{{item.matches}}" wx:for-item="match" wx:key="target.id" class="preview-target">{{match.target.name}} </text>
              </view>
            </view>
            <view class="rec-arrow">â€º</view>
          </view>
        </block>
        <view wx:else class="empty-role">
          <text>æš‚æ— æ¨è</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è‹±é›„é€‰æ‹©åˆ—è¡¨ -->
  <view class="hero-list-section">
    <!-- é‡è£… -->
    <view class="hero-role-section">
      <view class="role-section-header">
        <view class="role-section-bar tank-bar"></view>
        <text class="role-section-icon">ğŸ›¡</text>
        <text class="role-section-title">é‡è£… (Tank)</text>
        <view class="role-section-line"></view>
      </view>
      <view class="hero-grid">
        <view
          wx:for="{{tankHeroes}}"
          wx:key="id"
          class="hero-item {{selectedEnemies.length >= 6 && !isSelected(item.id) ? 'disabled' : ''}} {{selectedEnemies.some(function(h) { return h.id === item.id; }) ? 'selected' : ''}}"
          bindtap="onHeroTap"
          data-hero="{{item}}"
        >
          <view class="hero-avatar-wrap">
            <image
              class="hero-avatar"
              src="{{'/images/' + (item.id === 'wrecking-ball' ? 'ball' : item.id === 'soldier-76' ? 'soldier76' : item.id === 'junker-queen' ? 'junkerqueen' : item.id === 'venture' ? 'æ¢å¥‡' : item.id === 'hazard' ? 'éª‡ç¾' : item.id === 'freja' ? 'èŠ™è•¾é›…' : item.id === 'wuyang' ? 'æ— æ¼¾' : item.id) + '.png'}}"
              mode="aspectFill"
            />
          </view>
          <text class="hero-name">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- è¾“å‡º -->
    <view class="hero-role-section">
      <view class="role-section-header">
        <view class="role-section-bar damage-bar"></view>
        <text class="role-section-icon">ğŸ¯</text>
        <text class="role-section-title">è¾“å‡º (Damage)</text>
        <view class="role-section-line"></view>
      </view>
      <view class="hero-grid">
        <view
          wx:for="{{damageHeroes}}"
          wx:key="id"
          class="hero-item {{selectedEnemies.length >= 6 && !isSelected(item.id) ? 'disabled' : ''}} {{selectedEnemies.some(function(h) { return h.id === item.id; }) ? 'selected' : ''}}"
          bindtap="onHeroTap"
          data-hero="{{item}}"
        >
          <view class="hero-avatar-wrap">
            <image
              class="hero-avatar"
              src="{{'/images/' + (item.id === 'wrecking-ball' ? 'ball' : item.id === 'soldier-76' ? 'soldier76' : item.id === 'junker-queen' ? 'junkerqueen' : item.id === 'venture' ? 'æ¢å¥‡' : item.id === 'hazard' ? 'éª‡ç¾' : item.id === 'freja' ? 'èŠ™è•¾é›…' : item.id === 'wuyang' ? 'æ— æ¼¾' : item.id) + '.png'}}"
              mode="aspectFill"
            />
          </view>
          <text class="hero-name">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- æ”¯æ´ -->
    <view class="hero-role-section">
      <view class="role-section-header">
        <view class="role-section-bar support-bar"></view>
        <text class="role-section-icon">ğŸ’š</text>
        <text class="role-section-title">æ”¯æ´ (Support)</text>
        <view class="role-section-line"></view>
      </view>
      <view class="hero-grid">
        <view
          wx:for="{{supportHeroes}}"
          wx:key="id"
          class="hero-item {{selectedEnemies.length >= 6 && !isSelected(item.id) ? 'disabled' : ''}} {{selectedEnemies.some(function(h) { return h.id === item.id; }) ? 'selected' : ''}}"
          bindtap="onHeroTap"
          data-hero="{{item}}"
        >
          <view class="hero-avatar-wrap">
            <image
              class="hero-avatar"
              src="{{'/images/' + (item.id === 'wrecking-ball' ? 'ball' : item.id === 'soldier-76' ? 'soldier76' : item.id === 'junker-queen' ? 'junkerqueen' : item.id === 'venture' ? 'æ¢å¥‡' : item.id === 'hazard' ? 'éª‡ç¾' : item.id === 'freja' ? 'èŠ™è•¾é›…' : item.id === 'wuyang' ? 'æ— æ¼¾' : item.id) + '.png'}}"
              mode="aspectFill"
            />
          </view>
          <text class="hero-name">{{item.name}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æç¤º -->
  <view class="footer-info">
    <text class="info-icon">â„¹</text>
    <text class="info-text">æ•°æ®åŸºäºæœ€æ–°èµ›å­£ç‰ˆæœ¬ä¼˜åŒ– (S19 Updated)ã€‚åŒ…å«æ–°è‹±é›„ Hazardã€‚</text>
  </view>
</view>
